<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Squaredled Away – Kyra's Birthday Edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Readable, cozy fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&family=Baloo+2:wght@500;600;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      /* Night bathhouse palette */
      --sky-top: #020414;
      --sky-mid: #101633;
      --sky-bottom: #1c1530;

      --hill-dark: #101820;
      --hill-mid: #15222c;
      --hill-light: #1a2b33;

      --water-top: #111a2c;
      --water-mid: #172135;
      --water-bottom: #101524;

      --card-bg-soft: rgba(23, 16, 43, 0.96);
      --card-border: rgba(120, 91, 166, 0.9);
      --card-shadow: 0 22px 46px rgba(0, 0, 0, 0.95);

      --accent: #f2b26e;
      --accent-soft: rgba(240, 189, 120, 0.2);
      --accent-strong: #ffd49c;
      --accent-deep: #b95345;

      --text-main: #fdf7f0;
      --text-muted: #c2b7d2;

      --tile-bg: #261721;
      --tile-edge: #8b4b3f;
      --tile-selected-border: #f7e0a1;

      --danger: #f26f80;

      --radius-xl: 26px;
      --transition-fast: 140ms ease-out;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      font-family: "Nunito", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 24px;
      position: relative;
      overflow: hidden;
      background:
        radial-gradient(circle at 12% 0%, rgba(156, 189, 255, 0.4) 0, transparent 55%),
        radial-gradient(circle at 88% 0%, rgba(255, 226, 169, 0.32) 0, transparent 55%),
        linear-gradient(180deg, --sky-top 0%, var(--sky-mid) 45%, var(--sky-bottom) 75%, #050611 100%);
      background-attachment: fixed;
    }

    @media (max-width: 900px) {
      body {
        padding: 16px;
      }
    }

    /* POSTER: your wallpaper */
    .scene-poster {
      pointer-events: none;
      position: fixed;
      inset: 0;
      z-index: -7;
      background-image: url("spiritedawaybackground.jpg");
      background-position: center bottom;
      background-repeat: no-repeat;
      background-size: cover;
      filter: brightness(0.95) saturate(1.08);
      opacity: 0.85;
    }

    /* STAR FIELD */
    .scene-stars {
      pointer-events: none;
      position: fixed;
      inset: 0;
      z-index: -6;
      background-image:
        radial-gradient(circle, rgba(255, 255, 255, 0.7) 1px, transparent 0),
        radial-gradient(circle, rgba(255, 255, 255, 0.5) 1px, transparent 0),
        radial-gradient(circle, rgba(255, 255, 255, 0.6) 1.5px, transparent 0);
      background-size: 220px 260px, 260px 320px, 300px 280px;
      background-position: 10% 0%, 70% 15%, 40% 30%;
      opacity: 0.55;
    }

    /* CLOUDS */
    .scene-clouds {
      pointer-events: none;
      position: fixed;
      inset: 0;
      z-index: -5;
    }

    .cloud {
      position: absolute;
      width: 260px;
      height: 80px;
      border-radius: 40px;
      background: radial-gradient(circle at 20% 40%, rgba(255, 255, 255, 0.9) 0, rgba(228, 227, 255, 0.5) 40%, transparent 80%);
      filter: blur(2px);
      opacity: 0.45;
      animation: cloud-drift 60s linear infinite;
    }

    .cloud::before,
    .cloud::after {
      content: "";
      position: absolute;
      border-radius: inherit;
      background: inherit;
    }

    .cloud::before {
      width: 180px;
      height: 60px;
      left: -40px;
      top: 10px;
    }

    .cloud::after {
      width: 160px;
      height: 50px;
      right: -30px;
      top: 16px;
    }

    .cloud.c1 { top: 8%; left: -15%; animation-duration: 90s; }
    .cloud.c2 { top: 14%; left: 40%; animation-duration: 72s; }
    .cloud.c3 { top: 4%; left: 65%; animation-duration: 80s; opacity: 0.38; }

    @keyframes cloud-drift {
      from { transform: translateX(0); }
      to { transform: translateX(180%); }
    }

    /* HILLS / WATER / REFLECTION */
    .scene-horizon {
      position: fixed;
      left: -20%;
      right: -20%;
      bottom: 0;
      height: 55vh;
      pointer-events: none;
      z-index: -4;
    }

    .scene-hills {
      position: absolute;
      left: -10%;
      right: -10%;
      bottom: 18vh;
      height: 26vh;
      border-radius: 50% 50% 0 0;
      background:
        radial-gradient(circle at 15% 0%, rgba(117, 163, 171, 0.25) 0, transparent 55%),
        radial-gradient(circle at 75% 0%, rgba(198, 231, 238, 0.2) 0, transparent 55%),
        linear-gradient(180deg, var(--hill-light), var(--hill-mid));
      box-shadow: 0 -18px 40px rgba(0, 0, 0, 0.75);
    }

    .scene-hills::before {
      content: "";
      position: absolute;
      inset: 18px 10%;
      border-radius: 50% 50% 0 0;
      background:
        radial-gradient(circle at 30% 0%, rgba(91, 144, 152, 0.35) 0, transparent 55%),
        radial-gradient(circle at 80% 0%, rgba(80, 116, 129, 0.35) 0, transparent 60%),
        linear-gradient(180deg, var(--hill-mid), var(--hill-dark));
      opacity: 0.9;
    }

    .scene-water {
      position: absolute;
      left: -10%;
      right: -10%;
      bottom: -10vh;
      height: 32vh;
      background:
        radial-gradient(circle at 20% 0%, rgba(108, 143, 192, 0.3) 0, transparent 55%),
        radial-gradient(circle at 80% 0%, rgba(248, 210, 151, 0.25) 0, transparent 60%),
        linear-gradient(180deg, var(--water-top), var(--water-mid), var(--water-bottom));
      opacity: 0.9;
      box-shadow:
        0 -16px 30px rgba(0, 0, 0, 0.9),
        inset 0 16px 28px rgba(0, 0, 0, 0.65);
    }

    .scene-water::before {
      content: "";
      position: absolute;
      inset: 8% 6%;
      background-image:
        linear-gradient(
          rgba(255, 255, 255, 0.06) 1px,
          transparent 2px
        );
      background-size: 100% 10px;
      opacity: 0.4;
      mix-blend-mode: screen;
    }

    .scene-water::after {
      content: "";
      position: absolute;
      left: 18%;
      right: 18%;
      top: 8%;
      height: 36%;
      border-radius: 50% 50% 50% 50%;
      background: radial-gradient(circle at 50% 0%, rgba(247, 201, 132, 0.7) 0, transparent 60%);
      opacity: 0.7;
      filter: blur(4px);
    }

    /* Stylized bathhouse silhouette */
    .bathhouse-silhouette {
      position: fixed;
      bottom: 10vh;
      left: 50%;
      transform: translateX(-50%);
      width: 520px;
      height: 210px;
      pointer-events: none;
      z-index: -3;
    }

    .bathhouse-base,
    .bathhouse-mid,
    .bathhouse-top {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(180deg, #1f1016, #050307);
      border-radius: 6px;
      box-shadow: 0 -6px 20px rgba(0, 0, 0, 0.8);
    }

    .bathhouse-base {
      bottom: 0;
      width: 100%;
      height: 72px;
    }

    .bathhouse-mid {
      bottom: 60px;
      width: 74%;
      height: 62px;
    }

    .bathhouse-top {
      bottom: 115px;
      width: 46%;
      height: 46px;
    }

    .bathhouse-roof {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 155px;
      width: 54%;
      height: 20px;
      background: linear-gradient(180deg, #3e151b, #150309);
      border-radius: 12px 12px 4px 4px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.75);
    }

    .bathhouse-roof::before,
    .bathhouse-roof::after {
      content: "";
      position: absolute;
      bottom: -3px;
      width: 26%;
      height: 12px;
      background: linear-gradient(180deg, #632326, #2a0507);
      border-radius: 10px 10px 3px 3px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.7);
    }

    .bathhouse-roof::before { left: 5%; }
    .bathhouse-roof::after { right: 5%; }

    .bathhouse-lights {
      position: absolute;
      inset: 20px 20px 26px;
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-auto-rows: 14px;
      gap: 6px;
    }

    .bathhouse-light {
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0%, #fff7d0 0, #f7c86a 45%, rgba(0, 0, 0, 0.6) 100%);
      opacity: 0.25;
    }

    .bathhouse-light:nth-child(3n) { opacity: 0.42; }
    .bathhouse-light:nth-child(5n) { opacity: 0.65; }

    .bathhouse-gate {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 72px;
      width: 24%;
      height: 46px;
      background: linear-gradient(180deg, #2d0e11, #140306);
      border-radius: 6px;
      box-shadow: 0 -4px 8px rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .bathhouse-gate::before {
      content: "";
      width: 65%;
      height: 60%;
      border-radius: 999px;
      background: radial-gradient(circle at 50% 25%, #fff1c7 0, #f5c881 40%, transparent 80%);
      box-shadow: 0 0 18px rgba(247, 207, 140, 0.7);
    }

    .bathhouse-reflection {
      position: fixed;
      left: 50%;
      bottom: 4vh;
      transform: translateX(-50%) scaleY(-1);
      width: 480px;
      height: 90px;
      pointer-events: none;
      z-index: -2;
      opacity: 0.32;
      filter: blur(2.5px);
    }

    .bathhouse-reflection::before {
      content: "";
      position: absolute;
      inset: 12px 0 0;
      border-radius: 50%;
      background:
        radial-gradient(circle at 50% 0%, rgba(247, 201, 132, 0.55) 0, transparent 60%),
        radial-gradient(circle at 30% 0%, rgba(248, 240, 210, 0.4) 0, transparent 55%);
    }

    /* SPIRIT ORBS + LANTERNS */
    .spirit-orbs {
      pointer-events: none;
      position: fixed;
      inset: 0;
      z-index: -2;
    }

    .orb {
      position: absolute;
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.95) 0, rgba(159, 196, 255, 0.7) 40%, transparent 70%);
      box-shadow: 0 0 16px rgba(159, 196, 255, 0.9);
      animation: orb-drift 14s ease-in-out infinite alternate;
      opacity: 0.7;
    }

    .orb.o1 { top: 18%; left: 14%; animation-duration: 18s; }
    .orb.o2 { top: 28%; right: 16%; animation-duration: 16s; }
    .orb.o3 { top: 42%; left: 6%; animation-duration: 13s; }
    .orb.o4 { top: 52%; right: 8%; animation-duration: 19s; }
    .orb.o5 { top: 20%; left: 52%; animation-duration: 21s; }
    .orb.o6 { top: 34%; left: 32%; animation-duration: 15s; }

    @keyframes orb-drift {
      from { transform: translate3d(0, 0, 0); opacity: 0.5; }
      to { transform: translate3d(20px, -40px, 0); opacity: 1; }
    }

    .lantern {
      position: absolute;
      width: 30px;
      height: 52px;
      border-radius: 14px;
      background:
        radial-gradient(circle at 50% 20%, #fff7dc 0, #f5d093 40%, #c86a4d 100%);
      box-shadow:
        0 0 18px rgba(245, 208, 147, 0.85),
        0 0 48px rgba(245, 208, 147, 0.55);
      opacity: 0.92;
      animation: lantern-float 11s ease-in-out infinite alternate;
    }

    .lantern::before {
      content: "";
      position: absolute;
      top: -14px;
      left: 50%;
      width: 1px;
      height: 18px;
      transform: translateX(-50%);
      background: rgba(248, 231, 198, 0.7);
    }

    .lantern.l1 { top: 12%; left: 20%; animation-duration: 14s; }
    .lantern.l2 { top: 7%; right: 16%; animation-duration: 12s; }
    .lantern.l3 { top: 24%; left: 68%; animation-duration: 18s; }
    .lantern.l4 { top: 18%; left: 8%; animation-duration: 20s; }

    @keyframes lantern-float {
      0% { transform: translateY(0) translateX(0); }
      50% { transform: translateY(-12px) translateX(4px); }
      100% { transform: translateY(-4px) translateX(-4px); }
    }

    /* floating fireflies */
    .fireflies {
      pointer-events: none;
      position: fixed;
      inset: 0;
      z-index: -1;
    }

    .firefly {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: radial-gradient(circle, #fffdd0 0, rgba(255, 255, 160, 0.8) 40%, transparent 70%);
      box-shadow: 0 0 10px rgba(255, 254, 200, 0.9);
      opacity: 0;
      animation: firefly-float 10s ease-in-out infinite;
    }

    .firefly.f1 { top: 18%; left: 25%; animation-duration: 11s; }
    .firefly.f2 { top: 10%; right: 22%; animation-duration: 9s; }
    .firefly.f3 { top: 26%; left: 55%; animation-duration: 13s; }
    .firefly.f4 { top: 32%; right: 8%; animation-duration: 12s; }
    .firefly.f5 { top: 20%; left: 8%; animation-duration: 14s; }

    @keyframes firefly-float {
      0%   { transform: translate(0, 0); opacity: 0; }
      15%  { opacity: 1; }
      50%  { transform: translate(25px, -20px); opacity: 0.6; }
      85%  { transform: translate(-10px, -30px); opacity: 1; }
      100% { transform: translate(0, -40px); opacity: 0; }
    }

    /* FOG */
    .scene-fog {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: -1;
      background:
        radial-gradient(circle at 20% 80%, rgba(191, 211, 232, 0.08) 0, transparent 55%),
        radial-gradient(circle at 80% 80%, rgba(198, 215, 226, 0.1) 0, transparent 55%);
      mix-blend-mode: screen;
      animation: fog-drift 40s linear infinite alternate;
    }

    @keyframes fog-drift {
      from { transform: translate3d(-10px, 0, 0); opacity: 0.8; }
      to { transform: translate3d(20px, -5px, 0); opacity: 1; }
    }

    /* FOREGROUND RAIL / BRIDGE */
    .scene-rail {
      position: fixed;
      left: -15%;
      right: -15%;
      bottom: 4vh;
      height: 56px;
      pointer-events: none;
      z-index: 0;
    }

    .rail-sleeper {
      position: absolute;
      bottom: 6px;
      width: 80px;
      height: 14px;
      background: linear-gradient(180deg, #2a130f, #080203);
      border-radius: 4px;
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.8);
    }

    .rail-track {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      height: 8px;
      border-radius: 8px;
      background:
        linear-gradient(180deg, #e7d7cf, #7c8593);
      box-shadow:
        0 3px 5px rgba(0, 0, 0, 0.9),
        0 -1px 0 rgba(255, 255, 255, 0.4);
    }

    .rail-track::before,
    .rail-track::after {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.3) 0, transparent 30%, transparent 70%, rgba(255, 255, 255, 0.3) 100%);
    }

    .rail-track::before { top: 0; opacity: 0.8; }
    .rail-track::after { bottom: 0; opacity: 0.4; }

    /* tiny soot-spirits along the tracks */
    .mini-soots {
      position: fixed;
      bottom: 2.8vh;
      left: 8%;
      right: 8%;
      pointer-events: none;
      z-index: 1;
    }

    .mini-soot {
      position: absolute;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #050505;
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.9);
    }

    .mini-soot::before,
    .mini-soot::after {
      content: "";
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #ffffff;
      top: 5px;
    }

    .mini-soot::before { left: 3px; }
    .mini-soot::after  { right: 3px; }

    .mini-soot.m1 { left: 12%; animation: mini-soot-hop 6s ease-in-out infinite; }
    .mini-soot.m2 { left: 38%; animation: mini-soot-hop 7s ease-in-out infinite 1s; }
    .mini-soot.m3 { left: 66%; animation: mini-soot-hop 5.5s ease-in-out infinite 0.5s; }

    @keyframes mini-soot-hop {
      0%, 100% { transform: translateY(0); }
      20% { transform: translateY(-4px); }
      40% { transform: translateY(0); }
      60% { transform: translateY(-2px); }
      80% { transform: translateY(0); }
    }

    /* APP LAYOUT */
    .app-shell {
      max-width: 1180px;
      width: 100%;
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.5fr);
      gap: 20px;
      z-index: 1;
      position: relative;
    }

    @media (max-width: 900px) {
      .app-shell {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: radial-gradient(circle at top left, rgba(52, 35, 83, 0.88) 0, rgba(15, 10, 37, 0.98) 45%, rgba(8, 5, 24, 0.98) 100%);
      border-radius: var(--radius-xl);
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow: var(--card-shadow);
      position: relative;
      overflow: hidden;
      padding: 18px 20px 18px;
      backdrop-filter: blur(16px) saturate(1.2);
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.08) 0, transparent 55%),
        radial-gradient(circle at 100% 0, rgba(255, 255, 255, 0.04) 0, transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(255, 255, 255, 0.05) 0, transparent 55%);
      opacity: 0.45;
      pointer-events: none;
      mix-blend-mode: screen;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .card-title-group {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .card-title {
      font-family: "Baloo 2", system-ui, sans-serif;
      font-size: 1.5rem;
      letter-spacing: 0.03em;
      text-shadow:
        0 0 18px rgba(255, 240, 196, 0.55),
        0 0 28px rgba(151, 190, 255, 0.4);
    }

    .card-subtitle {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .spirit-tag {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.11em;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.35);
      background: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.16) 0, transparent 55%);
      color: var(--accent-strong);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .spirit-tag-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: radial-gradient(circle, #fffcc7 0, #f7c56e 45%, rgba(0, 0, 0, 0.4) 100%);
      box-shadow: 0 0 10px rgba(255, 243, 200, 0.95);
    }

    /* GRID CARD */
    .grid-wrapper {
      margin-top: 6px;
      border-radius: 24px;
      padding: 16px;
      background:
        radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.03) 0, transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(255, 255, 255, 0.05) 0, transparent 65%),
        linear-gradient(145deg, rgba(17, 7, 26, 0.95), rgba(10, 4, 19, 0.98));
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow:
        inset 0 0 0 1px rgba(255, 255, 255, 0.03),
        0 18px 32px rgba(0, 0, 0, 0.85);
    }

    .grid-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .grid-title {
      font-size: 0.95rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .grid-meta {
      display: flex;
      gap: 10px;
      font-size: 0.78rem;
      color: var(--text-muted);
      opacity: 0.9;
    }

    .grid-meta-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(16, 8, 33, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .grid-meta-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: radial-gradient(circle, #fffcc7 0, #f7c56e 45%, rgba(0, 0, 0, 0.4) 100%);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-template-rows: repeat(7, 1fr);
      gap: 7px;
      margin-top: 12px;
    }

    .tile {
      position: relative;
      width: 100%;
      aspect-ratio: 1;
      border-radius: 16px;
      border: 1px solid rgba(228, 200, 164, 0.45);
      background:
        radial-gradient(circle at 25% 0%, rgba(255, 255, 255, 0.18) 0, transparent 55%),
        linear-gradient(145deg, #2e1821, #180914);
      color: #ffeadd;
      font-size: 1.25rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow:
        0 14px 22px rgba(0, 0, 0, 0.9),
        inset 0 0 0 1px rgba(255, 255, 255, 0.04);
      transition:
        transform var(--transition-fast),
        box-shadow var(--transition-fast),
        border-color var(--transition-fast),
        background 160ms ease-out;
    }

    .tile::before {
      content: "";
      position: absolute;
      inset: 10%;
      border-radius: inherit;
      border: 1px solid rgba(255, 255, 255, 0.06);
      pointer-events: none;
    }

    .tile:hover {
      transform: translateY(-2px);
      box-shadow:
        0 18px 24px rgba(0, 0, 0, 0.95),
        0 0 18px rgba(255, 227, 185, 0.35);
      border-color: rgba(255, 230, 182, 0.85);
      background:
        radial-gradient(circle at 25% 0%, rgba(255, 245, 228, 0.26) 0, transparent 68%),
        linear-gradient(145deg, #3a2026, #1c0c17);
    }

    .tile.selected {
      border-color: var(--tile-selected-border);
      box-shadow:
        0 18px 26px rgba(0, 0, 0, 0.95),
        0 0 24px rgba(255, 241, 197, 0.5);
      background:
        radial-gradient(circle at 25% 0%, rgba(255, 255, 255, 0.32) 0, transparent 70%),
        linear-gradient(145deg, #4a222a, #2a0f1c);
      transform: translateY(-3px);
    }

    .tile.blank {
      background: radial-gradient(circle at 50% 0%, rgba(20, 15, 35, 0.9) 0, rgba(7, 5, 18, 0.98) 70%);
      border-style: dashed;
      border-color: rgba(148, 112, 99, 0.6);
      color: rgba(255, 255, 255, 0.16);
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.85);
      cursor: default;
    }

    .tile-index {
      position: absolute;
      bottom: 4px;
      right: 6px;
      font-size: 0.68rem;
      color: rgba(255, 245, 220, 0.85);
      opacity: 0.9;
      text-shadow: 0 0 4px rgba(0, 0, 0, 1);
    }

    .current-word-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 14px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(10, 7, 26, 0.96);
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.85);
    }

    .current-word-label {
      font-size: 0.82rem;
      color: var(--text-muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .current-word-value {
      font-family: "Baloo 2", system-ui, sans-serif;
      font-size: 1.1rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      min-height: 1.2em;
    }

    .current-word-hint {
      font-size: 0.75rem;
      color: rgba(255, 245, 220, 0.9);
      opacity: 0.9;
    }

    .controls-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .goal-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(12, 7, 34, 0.96);
      border: 1px solid rgba(255, 255, 255, 0.08);
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .goal-chip strong {
      color: #ffe9c2;
      font-weight: 700;
    }

    .reset-btn {
      border-radius: 999px;
      padding: 6px 12px;
      background: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.2) 0, transparent 60%);
      border: 1px solid rgba(255, 255, 255, 0.24);
      color: #ffeadd;
      font-size: 0.78rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 12px 18px rgba(0, 0, 0, 0.85);
      transition:
        transform var(--transition-fast),
        box-shadow var(--transition-fast),
        background 140ms ease-out;
    }

    .reset-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 22px rgba(0, 0, 0, 0.95);
      background:
        radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.26) 0, transparent 62%);
    }

    /* RIGHT COLUMN: special words + goals + mascot */
    .right-column {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .special-card {
      margin-bottom: 4px;
    }

    .special-list {
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 18px;
      background: rgba(13, 8, 34, 0.98);
      border: 1px solid rgba(255, 255, 255, 0.07);
      max-height: 190px;
      overflow-y: auto;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.02);
    }

    .special-list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 7px;
      border-radius: 999px;
      margin-bottom: 4px;
      font-size: 0.86rem;
      background: transparent;
      color: var(--text-muted);
    }

    .special-list-item.found {
      background: linear-gradient(90deg, rgba(255, 228, 185, 0.12), rgba(198, 176, 255, 0.18));
      color: #ffe9c2;
    }

    .special-word-label {
      letter-spacing: 0.12em;
      text-transform: uppercase;
      font-size: 0.76rem;
    }

    .special-word-badge {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.16);
      background: rgba(18, 9, 38, 0.94);
    }

    .goals-card {
      margin-bottom: 4px;
    }

    .goals-progress {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .goal-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .goal-label-line {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .goal-label-line strong {
      color: #ffe9c2;
    }

    .goal-bar-outer {
      height: 8px;
      border-radius: 999px;
      background: rgba(12, 7, 28, 0.98);
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.05);
    }

    .goal-bar-inner {
      height: 100%;
      border-radius: inherit;
      background: linear-gradient(90deg, #f2b26e, #ffd49c, #9fd0ff);
      width: 0%;
      transition: width 260ms ease-out;
      box-shadow: 0 0 10px rgba(255, 226, 179, 0.85);
    }

    /* FOUND WORDS LIST */
    .found-card {
      margin-top: 2px;
      flex: 1;
      min-height: 160px;
    }

    .found-words-list {
      margin-top: 10px;
      padding: 8px 10px 4px;
      border-radius: 18px;
      background: rgba(13, 8, 34, 0.98);
      border: 1px solid rgba(255, 255, 255, 0.08);
      max-height: 210px;
      overflow-y: auto;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.02);
      font-size: 0.86rem;
    }

    .found-word-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      padding: 4px 6px;
      border-radius: 999px;
      margin-bottom: 3px;
      align-items: center;
    }

    .found-word-row.special {
      background: linear-gradient(90deg, rgba(255, 228, 185, 0.12), rgba(198, 176, 255, 0.18));
      color: #ffe9c2;
    }

    .found-word-row.normal {
      background: rgba(10, 5, 27, 0.85);
      color: var(--text-muted);
    }

    .found-word-text {
      letter-spacing: 0.12em;
      text-transform: uppercase;
      font-size: 0.78rem;
    }

    .found-word-meta {
      font-size: 0.76rem;
      opacity: 0.85;
    }

    /* MASCOT */
    .mascot-card {
      margin-top: 2px;
    }

    .mascot-wrapper {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 8px;
    }

    .mascot-figure-shell {
      position: relative;
      width: 120px;
      flex-shrink: 0;
    }

    .mascot-figure {
      position: relative;
      width: 100%;
      height: 120px;
      border-radius: 30px;
      background:
        radial-gradient(circle at 20% 0%, rgba(255, 255, 255, 0.24) 0, transparent 55%),
        linear-gradient(180deg, rgba(25, 22, 56, 0.98), rgba(11, 7, 29, 0.98));
      box-shadow:
        0 14px 28px rgba(0, 0, 0, 0.9),
        inset 0 0 0 1px rgba(255, 255, 255, 0.08);
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding-bottom: 6px;
      overflow: hidden;
    }

    .mascot-glow {
      position: absolute;
      inset: 6px;
      border-radius: inherit;
      background: radial-gradient(circle at 50% 0%, rgba(249, 228, 182, 0.55) 0, transparent 55%);
      opacity: 0.9;
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .mascot-image {
      position: relative;
      z-index: 2;
      display: block;
      max-height: 110px;
      width: auto;
      object-fit: contain;
      filter: drop-shadow(0 12px 18px rgba(0, 0, 0, 0.85));
      transition:
        transform 180ms ease-out,
        filter 180ms ease-out;
    }

    .mascot {
      position: relative;
    }

    .mascot.mood-soft .mascot-image {
      transform: translateY(0);
    }

    .mascot.mood-shy .mascot-image {
      transform: translateY(1px) scale(0.98);
    }

    .mascot.mood-mischief .mascot-image {
      transform: translateY(-2px) rotate(-2deg);
    }

    .mascot.mood-excited .mascot-image {
      animation: mascot-bounce 900ms ease-out infinite alternate;
    }

    @keyframes mascot-bounce {
      0% { transform: translateY(0); }
      50% { transform: translateY(-2px) scale(1.01); }
      100% { transform: translateY(-4px) scale(1.02); }
    }

    .mascot.dancing .mascot-image {
      animation: mascot-dance 900ms ease-in-out;
    }

    @keyframes mascot-dance {
      0% { transform: translateY(0) rotate(0); }
      20% { transform: translateY(-2px) rotate(-3deg); }
      40% { transform: translateY(-3px) rotate(3deg); }
      60% { transform: translateY(-2px) rotate(-2deg); }
      80% { transform: translateY(-1px) rotate(2deg); }
      100% { transform: translateY(0) rotate(0); }
    }

    .mascot-speech {
      flex: 1;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(10, 5, 27, 0.96);
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow:
        0 10px 18px rgba(0, 0, 0, 0.85),
        inset 0 0 0 1px rgba(255, 255, 255, 0.04);
      font-size: 0.86rem;
      line-height: 1.35;
      position: relative;
    }

    .mascot-speech::before {
      content: "";
      position: absolute;
      left: -12px;
      top: 18px;
      border-width: 8px 12px 8px 0;
      border-style: solid;
      border-color: transparent rgba(15, 8, 35, 0.98) transparent transparent;
      filter: drop-shadow(0 0 4px rgba(0, 0, 0, 0.7));
    }

    .mascot-speech-label {
      display: inline-flex;
      align-items: center;
      gap: 7px;
      font-size: 0.74rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: rgba(255, 238, 203, 0.92);
      margin-bottom: 4px;
      opacity: 0.9;
    }

    .mascot-speech-label span {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: radial-gradient(circle, #fffcc7 0, #f7c56e 45%, rgba(0, 0, 0, 0.4) 100%);
      box-shadow: 0 0 10px rgba(255, 243, 200, 0.85);
    }

    /* Toasts */
    .toast-container {
      position: fixed;
      top: 14px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 20;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
      pointer-events: none;
    }

    .toast {
      pointer-events: auto;
      min-width: 260px;
      max-width: 340px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(7, 4, 18, 0.96);
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow:
        0 14px 22px rgba(0, 0, 0, 0.9),
        0 0 18px rgba(255, 229, 185, 0.3);
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.86rem;
      color: #ffeadd;
      transform: translateY(-8px);
      opacity: 0;
      animation: toast-in 180ms ease-out forwards;
    }

    .toast-bad {
      border-color: rgba(242, 111, 128, 0.65);
      box-shadow:
        0 14px 26px rgba(0, 0, 0, 0.9),
        0 0 16px rgba(242, 111, 128, 0.5);
    }

    .toast-emoji {
      font-size: 1.1rem;
    }

    @keyframes toast-in {
      from {
        opacity: 0;
        transform: translateY(-8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes toast-out {
      from {
        opacity: 1;
        transform: translateY(0);
      }
      to {
        opacity: 0;
        transform: translateY(-8px);
      }
    }

    /* Completion overlay */
    .overlay {
      position: fixed;
      inset: 0;
      z-index: 40;
      background:
        radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.2) 0, transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(157, 193, 255, 0.25) 0, transparent 55%),
        rgba(3, 2, 10, 0.96);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
    }

    .overlay.visible {
      display: flex;
    }

    .overlay-card {
      max-width: 520px;
      width: 100%;
      background: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.16) 0, transparent 62%),
        radial-gradient(circle at 100% 100%, rgba(255, 255, 255, 0.16) 0, transparent 62%),
        linear-gradient(180deg, rgba(23, 16, 43, 0.98), rgba(8, 5, 22, 0.98));
      border-radius: 26px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow:
        0 22px 48px rgba(0, 0, 0, 0.98),
        0 0 24px rgba(255, 232, 196, 0.38);
      padding: 18px 18px 14px;
      position: relative;
      overflow: hidden;
    }

    .overlay-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 50% -20%, rgba(255, 255, 255, 0.28) 0, transparent 70%),
        radial-gradient(circle at 10% 120%, rgba(231, 195, 255, 0.23) 0, transparent 60%);
      opacity: 0.7;
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .overlay-inner {
      position: relative;
      z-index: 1;
    }

    .overlay-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 10px;
    }

    .overlay-title {
      font-family: "Baloo 2", system-ui, sans-serif;
      font-size: 1.4rem;
    }

    .overlay-badge {
      font-size: 0.75rem;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(10, 6, 25, 0.97);
      border: 1px solid rgba(255, 255, 255, 0.22);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .overlay-badge span {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: radial-gradient(circle, #fffcc7 0, #f7c56e 45%, rgba(0, 0, 0, 0.4) 100%);
      box-shadow: 0 0 10px rgba(255, 243, 200, 0.9);
    }

    .overlay-body {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .overlay-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 10px;
    }

    .overlay-button {
      border-radius: 999px;
      padding: 6px 12px;
      background: rgba(10, 6, 25, 0.97);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #ffeadd;
      font-size: 0.78rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 14px 22px rgba(0, 0, 0, 0.9);
      transition:
        transform var(--transition-fast),
        box-shadow var(--transition-fast),
        background 140ms ease-out;
    }

    .overlay-button.primary {
      background: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.22) 0, transparent 60%);
    }

    .overlay-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 24px rgba(0, 0, 0, 0.95);
    }
  </style>
</head>
<body>
  <div class="scene-poster"></div>
  <div class="scene-stars"></div>
  <div class="scene-clouds">
    <div class="cloud c1"></div>
    <div class="cloud c2"></div>
    <div class="cloud c3"></div>
  </div>
  <div class="scene-horizon">
    <div class="scene-hills"></div>
    <div class="scene-water"></div>
  </div>
  <div class="bathhouse-silhouette">
    <div class="bathhouse-base"></div>
    <div class="bathhouse-mid"></div>
    <div class="bathhouse-top"></div>
    <div class="bathhouse-roof"></div>
    <div class="bathhouse-lights">
      <div class="bathhouse-light"></div>
      <div class="bathhouse-light"></div>
      <div class="bathhouse-light"></div>
      <div class="bathhouse-light"></div>
      <div class="bathhouse-light"></div>
      <div class="bathhouse-light"></div>
      <div class="bathhouse-light"></div>
      <div class="bathhouse-light"></div>
      <div class="bathhouse-light"></div>
      <div class="bathhouse-light"></div>
      <div class="bathhouse-light"></div>
      <div class="bathhouse-light"></div>
      <div class="bathhouse-light"></div>
      <div class="bathhouse-light"></div>
    </div>
    <div class="bathhouse-gate"></div>
  </div>
  <div class="bathhouse-reflection"></div>

  <div class="spirit-orbs">
    <div class="orb o1"></div>
    <div class="orb o2"></div>
    <div class="orb o3"></div>
    <div class="orb o4"></div>
    <div class="orb o5"></div>
    <div class="orb o6"></div>
  </div>

  <div class="lantern l1"></div>
  <div class="lantern l2"></div>
  <div class="lantern l3"></div>
  <div class="lantern l4"></div>

  <div class="fireflies">
    <div class="firefly f1"></div>
    <div class="firefly f2"></div>
    <div class="firefly f3"></div>
    <div class="firefly f4"></div>
    <div class="firefly f5"></div>
  </div>

  <div class="scene-fog"></div>

  <div class="scene-rail">
    <div class="rail-track"></div>
    <div class="rail-sleeper" style="left: 5%;"></div>
    <div class="rail-sleeper" style="left: 25%;"></div>
    <div class="rail-sleeper" style="left: 45%;"></div>
    <div class="rail-sleeper" style="left: 65%;"></div>
    <div class="rail-sleeper" style="left: 85%;"></div>
  </div>

  <div class="mini-soots">
    <div class="mini-soot m1"></div>
    <div class="mini-soot m2"></div>
    <div class="mini-soot m3"></div>
  </div>

  <div class="toast-container" id="toastContainer"></div>

  <div class="overlay" id="completionOverlay">
    <div class="overlay-card">
      <div class="overlay-inner">
        <div class="overlay-header">
          <div>
            <div class="overlay-title">You solved Squaredled Away!</div>
            <div class="overlay-badge">
              <span></span>
              All special words found
            </div>
          </div>
          <button class="overlay-button" id="closeOverlayBtn">
            Close
          </button>
        </div>
        <div class="overlay-body">
          The bathhouse is full of delighted word-spirits. You’ve found every special guest that was meant for this night, and more besides.
        </div>
        <div class="overlay-actions">
          <button class="overlay-button" id="playAgainBtn">
            Play again
          </button>
        </div>
      </div>
    </div>
  </div>

  <main class="app-shell">
    <section class="card">
      <div class="card-inner">
        <header class="card-header">
          <div class="card-title-group">
            <h1 class="card-title">Squaredle</h1>
            <p class="card-subtitle">Kyra's Birthday Edition</p>
          </div>
          <div class="spirit-tag">
            <span class="spirit-tag-dot"></span>
            Night Train Word Puzzle
          </div>
        </header>

        <div class="grid-wrapper">
          <div class="grid-header-row">
            <div class="grid-title">7 × 7 Path Puzzle</div>
            <div class="grid-meta">
              <div class="grid-meta-item">
                <span class="grid-meta-dot"></span>
                Drag through adjacent letters
              </div>
              <div class="grid-meta-item">
                <span class="grid-meta-dot"></span>
                Discover hidden spirit words
              </div>
            </div>
          </div>

          <div id="grid" class="grid"></div>

          <div class="current-word-row">
            <div>
              <div class="current-word-label">Current Path</div>
              <div id="currentWord" class="current-word-value"></div>
              <div class="current-word-hint">Drag along neighboring letters. Release to submit.</div>
            </div>
          </div>

          <div class="controls-row">
            <div class="goal-chip">
              <strong>Goal:</strong> Find all 5 special words and meet minimum word-spirits.
            </div>
            <button class="reset-btn" id="resetBtn">
              Reset Puzzle
            </button>
          </div>
        </div>
      </div>
    </section>

    <section class="right-column">
      <article class="card special-card">
        <div class="card-inner">
          <header class="card-header" style="margin-bottom: 6px;">
            <div class="card-title-group">
              <h2 class="card-title" style="font-size: 1.15rem;">Special Guests</h2>
              <p class="card-subtitle">These hidden words are especially meaningful to Kyra.</p>
            </div>
          </header>
          <div class="special-list" id="specialList"></div>
        </div>
      </article>

      <article class="card goals-card">
        <div class="card-inner">
          <header class="card-header" style="margin-bottom: 6px;">
            <div class="card-title-group">
              <h2 class="card-title" style="font-size: 1.15rem;">Word-Spirit Goals</h2>
              <p class="card-subtitle">Beyond the 5 special guests, invite plenty of other spirits.</p>
            </div>
          </header>

          <div class="goals-progress">
            <div class="goal-row">
              <div class="goal-label-line">
                <span>Four-letter words</span>
                <span id="goalCount4">0 / 10</span>
              </div>
              <div class="goal-bar-outer">
                <div class="goal-bar-inner" id="goalBar4"></div>
              </div>
            </div>

            <div class="goal-row">
              <div class="goal-label-line">
                <span>Five-letter words</span>
                <span id="goalCount5">0 / 5</span>
              </div>
              <div class="goal-bar-outer">
                <div class="goal-bar-inner" id="goalBar5"></div>
              </div>
            </div>

            <div class="goal-row">
              <div class="goal-label-line">
                <span>Words 6+ letters</span>
                <span id="goalCount6">0 / 3</span>
              </div>
              <div class="goal-bar-outer">
                <div class="goal-bar-inner" id="goalBar6"></div>
              </div>
            </div>
          </div>
        </div>
      </article>

      <article class="card found-card">
        <div class="card-inner">
          <header class="card-header" style="margin-bottom: 6px;">
            <div class="card-title-group">
              <h2 class="card-title" style="font-size: 1.15rem;">Found Word-Spirits</h2>
              <p class="card-subtitle">Every path you discover becomes a guest on tonight’s train.</p>
            </div>
          </header>
          <div class="found-words-list" id="foundWordsList"></div>
        </div>
      </article>

      <article class="card mascot-card">
        <div class="card-inner">
          <header class="card-header" style="margin-bottom: 6px;">
            <div class="card-title-group">
              <h2 class="card-title" style="font-size: 1.15rem;">Frog Guide</h2>
              <p class="card-subtitle">Click the frog if you’d like a gentle hint.</p>
            </div>
          </header>

          <div class="mascot-wrapper">
            <div class="mascot-figure-shell">
              <div id="mascot" class="mascot mood-soft">
                <div class="mascot-figure">
                  <div class="mascot-glow"></div>
                  <img
                    id="mascotImage"
                    class="mascot-image"
                    src="frog-neutral.png"
                    alt="Frog spirit in a kimono"
                  />
                </div>
              </div>
            </div>

            <div class="mascot-speech" id="mascotSpeech">
              <div class="mascot-speech-label">
                <span></span>
                Frog guide
              </div>
              Happy birthday, Kyra. Let’s wander the rails and see which words the spirits like best tonight. ✨
            </div>
          </div>
        </div>
      </article>
    </section>
  </main>

  <!-- Audio -->
  <audio id="ambientAudio" loop>
    <source src="ambient.mp3" type="audio/mpeg" />
  </audio>
  <audio id="specialSound">
    <source src="special.mp3" type="audio/mpeg" />
  </audio>

  <script>
    const GRID = [
      ["b", "r", "i", "g", "h", "t", " "],
      [" ", "a", "k", "y", "r", "a", " "],
      [" ", "t", "o", "w", "n", "s", " "],
      [" ", "r", "a", "i", "n", "s", " "],
      [" ", "o", "n", "s", "e", "n", " "],
      [" ", "s", "p", "i", "r", "i", "t"],
      [" ", " ", " ", " ", " ", " ", "s"],
    ];

    const SPECIAL_WORDS = [
      "bright",
      "kyra",
      "towns",
      "rains",
      "onsen",
      "spirits"
    ];

    const SPECIAL_SET = new Set(SPECIAL_WORDS.map(w => w.toLowerCase()));

    const GOALS = {
      four: 10,
      five: 5,
      sixPlus: 3
    };

    const MASCOT_IMAGES = {
      neutral: "frog-neutral.png",
      excited: "frog-excited.png",
      running: "frog-running.png",
      jumping: "frog-jumping.png",
      thinking: "frog-thinking.png",
      reflecting: "frog-reflecting.png",
      idea: "frog-idea.png"
    };

    // --- State ---
    const state = {
      path: [],
      foundWords: [],
      foundSet: new Set(),
      specialFound: new Set(),
      dragging: false
    };

    // --- DOM refs ---
    const gridEl = document.getElementById("grid");
    const currentWordEl = document.getElementById("currentWord");
    const specialListEl = document.getElementById("specialList");
    const foundWordsListEl = document.getElementById("foundWordsList");
    const goalBar4El = document.getElementById("goalBar4");
    const goalBar5El = document.getElementById("goalBar5");
    const goalBar6El = document.getElementById("goalBar6");
    const count4El = document.getElementById("goalCount4");
    const count5El = document.getElementById("goalCount5");
    const count6El = document.getElementById("goalCount6");
    const toastContainer = document.getElementById("toastContainer");
    const mascotEl = document.getElementById("mascot");
    const mascotImageEl = document.getElementById("mascotImage");
    const mascotSpeechEl = document.getElementById("mascotSpeech");
    const ambientAudioEl = document.getElementById("ambientAudio");
    const specialSoundEl = document.getElementById("specialSound");
    const resetBtn = document.getElementById("resetBtn");
    const overlayEl = document.getElementById("completionOverlay");
    const closeOverlayBtn = document.getElementById("closeOverlayBtn");
    const playAgainBtn = document.getElementById("playAgainBtn");

    let ambientStarted = false;
    let mascotMood = "soft";

    function startAmbientMusic() {
      if (ambientStarted || !ambientAudioEl) return;
      ambientStarted = true;
      try {
        ambientAudioEl.volume = 0.35;
        ambientAudioEl.play();
      } catch (e) {}
    }

    function showToast(message, { good = true, emoji = "✨" } = {}) {
      if (!toastContainer) return;

      const toast = document.createElement("div");
      toast.className = "toast" + (good ? "" : " toast-bad");

      const emojiSpan = document.createElement("span");
      emojiSpan.className = "toast-emoji";
      emojiSpan.textContent = emoji;

      const textSpan = document.createElement("span");
      textSpan.textContent = message;

      toast.appendChild(emojiSpan);
      toast.appendChild(textSpan);
      toastContainer.appendChild(toast);

      setTimeout(() => {
        toast.style.animation = "toast-out 160ms ease-in forwards";
        setTimeout(() => {
          if (toast.parentNode === toastContainer) {
            toastContainer.removeChild(toast);
          }
        }, 170);
      }, 2000);
    }

    function setMascotMessage(message) {
      if (!mascotSpeechEl) return;
      mascotSpeechEl.textContent = message;
    }

    function setMascotMood(mood) {
      if (!mascotEl) return;
      mascotMood = mood;

      // Remove existing animation classes
      mascotEl.classList.remove("mood-soft", "mood-shy", "mood-mischief", "mood-excited");

      // Decide which animation style to use for this mood
      let animationClass = "mood-soft";
      if (["excited", "jumping", "celebrate"].includes(mood)) {
        animationClass = "mood-excited";
      } else if (["mischief", "running"].includes(mood)) {
        animationClass = "mood-mischief";
      } else if (["shy"].includes(mood)) {
        animationClass = "mood-shy";
      } else {
        animationClass = "mood-soft";
      }
      mascotEl.classList.add(animationClass);

      // Decide which image to show
      let imageKey;
      if (["soft", "neutral", "shy"].includes(mood)) {
        imageKey = "neutral";
      } else if (["excited", "celebrate"].includes(mood)) {
        imageKey = "excited";
      } else if (["jumping"].includes(mood)) {
        imageKey = "jumping";
      } else if (["mischief", "running"].includes(mood)) {
        imageKey = "running";
      } else if (["thinking"].includes(mood)) {
        imageKey = "thinking";
      } else if (["reflecting"].includes(mood)) {
        imageKey = "reflecting";
      } else if (["idea", "hint"].includes(mood)) {
        imageKey = "idea";
      } else {
        imageKey = "neutral";
      }

      const src = MASCOT_IMAGES[imageKey] || MASCOT_IMAGES.neutral;
      if (mascotImageEl && src) {
        mascotImageEl.src = src;
      }
    }

    function giveHint() {
      if (!mascotEl) return;

      const remainingSpecial = SPECIAL_WORDS.filter(w => !state.specialFound.has(w.toLowerCase()));
      let message;

      if (!remainingSpecial.length) {
        message = "Every special guest has already signed the guestbook. Now you can wander and enjoy the night. 🌌";
      } else {
        const choice = remainingSpecial[Math.floor(Math.random() * remainingSpecial.length)];
        const len = choice.length;
        const firstLetter = choice[0].toUpperCase();

        message = `Pssst… I can see a special word that’s ${len} letters long and begins with “${firstLetter}”. Follow where that letter appears on the tracks. 💡`;
      }

      setMascotMood("idea");
      setMascotMessage(message);
      showToast("Hint from your frog guide.", { good: true, emoji: "💡" });

      // Gently return to a neutral mood after a short moment,
      // but only if the player hasn't changed the mood in between.
      setTimeout(() => {
        if (mascotMood === "idea") {
          setMascotMood("soft");
        }
      }, 4500);
    }

    function triggerMascotDance() {
      if (!mascotEl) return;
      mascotEl.classList.add("dancing");
      setTimeout(() => {
        mascotEl.classList.remove("dancing");
      }, 900);
    }

    function getCurrentWord() {
      return state.path.map(({ letter }) => letter).join("");
    }

    function updateCurrentWordDisplay() {
      const word = getCurrentWord();
      if (!word) {
        currentWordEl.textContent = "";
      } else {
        currentWordEl.textContent = word.toUpperCase();
      }
    }

    function updateSpecialListUI() {
      if (!specialListEl) return;
      specialListEl.innerHTML = "";

      SPECIAL_WORDS.forEach(word => {
        const isFound = state.specialFound.has(word.toLowerCase());
        const li = document.createElement("div");
        li.className = "special-list-item" + (isFound ? " found" : "");
        const labelSpan = document.createElement("span");
        labelSpan.className = "special-word-label";
        labelSpan.textContent = word.toUpperCase();

        const badgeSpan = document.createElement("span");
        badgeSpan.className = "special-word-badge";
        badgeSpan.textContent = isFound ? "Found" : "Hidden";

        li.appendChild(labelSpan);
        li.appendChild(badgeSpan);
        specialListEl.appendChild(li);
      });
    }

    function updateWordsUI() {
      if (!foundWordsListEl) return;
      foundWordsListEl.innerHTML = "";

      state.foundWords.slice().reverse().forEach(entry => {
        const li = document.createElement("div");
        li.className = "found-word-row " + (entry.isSpecial ? "special" : "normal");

        const wordSpan = document.createElement("span");
        wordSpan.className = "found-word-text";
        wordSpan.textContent = entry.word.toUpperCase();

        const metaSpan = document.createElement("span");
        metaSpan.className = "found-word-meta";
        metaSpan.textContent = `${entry.word.length} letters`;

        li.appendChild(wordSpan);
        li.appendChild(metaSpan);
        foundWordsListEl.appendChild(li);
      });
    }

    function updateGoalProgressUI() {
      let count4 = 0;
      let count5 = 0;
      let count6 = 0;

      state.foundWords.forEach(({ word, isSpecial }) => {
        if (isSpecial) return;
        const len = word.length;
        if (len === 4) count4++;
        else if (len === 5) count5++;
        else if (len >= 6) count6++;
      });

      const p4 = Math.min(1, count4 / GOALS.four);
      const p5 = Math.min(1, count5 / GOALS.five);
      const p6 = Math.min(1, count6 / GOALS.sixPlus);

      goalBar4El.style.width = (p4 * 100).toFixed(0) + "%";
      goalBar5El.style.width = (p5 * 100).toFixed(0) + "%";
      goalBar6El.style.width = (p6 * 100).toFixed(0) + "%";

      count4El.textContent = `${count4} / ${GOALS.four}`;
      count5El.textContent = `${count5} / ${GOALS.five}`;
      count6El.textContent = `${count6} / ${GOALS.sixPlus}`;
    }

    function checkCompletion() {
      const allSpecialFound = SPECIAL_WORDS.every(w => state.specialFound.has(w.toLowerCase()));
      if (!allSpecialFound) return false;

      let count4 = 0;
      let count5 = 0;
      let count6 = 0;

      state.foundWords.forEach(({ word, isSpecial }) => {
        if (isSpecial) return;
        const len = word.length;
        if (len === 4) count4++;
        else if (len === 5) count5++;
        else if (len >= 6) count6++;
      });

      const meets4 = count4 >= GOALS.four;
      const meets5 = count5 >= GOALS.five;
      const meets6 = count6 >= GOALS.sixPlus;

      return allSpecialFound && meets4 && meets5 && meets6;
    }

    function showCompletionOverlay() {
      if (!overlayEl) return;
      overlayEl.classList.add("visible");
      setMascotMood("soft");
      setMascotMessage("You’ve guided every special guest safely to the bathhouse. The night is full and content. ✨");
    }

    function hideCompletionOverlay() {
      if (!overlayEl) return;
      overlayEl.classList.remove("visible");
    }

    function clearPath() {
      state.path.forEach(({ tile }) => {
        tile.classList.remove("selected");
        const idx = tile.querySelector(".tile-index");
        if (idx) idx.textContent = "";
      });
      state.path = [];
      updateCurrentWordDisplay();
    }

    function addTileToPath(tile) {
      if (tile.classList.contains("blank")) return;

      const row = parseInt(tile.dataset.row, 10);
      const col = parseInt(tile.dataset.col, 10);
      const letter = GRID[row][col];

      const last = state.path[state.path.length - 1];
      if (last && last.row === row && last.col === col) {
        return;
      }

      if (state.path.some(p => p.row === row && p.col === col)) {
        return;
      }

      if (last) {
        const dr = Math.abs(last.row - row);
        const dc = Math.abs(last.col - col);
        if (dr > 1 || dc > 1 || (dr === 0 && dc === 0)) {
          return;
        }
      }

      state.path.push({ row, col, letter, tile });
      tile.classList.add("selected");

      const idx = tile.querySelector(".tile-index") || (() => {
        const el = document.createElement("div");
        el.className = "tile-index";
        tile.appendChild(el);
        return el;
      })();
      idx.textContent = state.path.length.toString();

      updateCurrentWordDisplay();
    }

    function handleSubmitWord() {
      const word = getCurrentWord().toLowerCase();
      if (!word || word.length < 3) {
        showToast("That word is a little too shy.", { good: false, emoji: "⚠️" });
        clearPath();
        setMascotMood("thinking");
        setMascotMessage("Try taking a slightly longer stroll along the rails. The spirits like longer names. 🌬️");
        return;
      }

      if (state.foundSet.has(word)) {
        showToast("We’ve already greeted that spirit.", { good: false, emoji: "🔁" });
        clearPath();
        setMascotMood("reflecting");
        setMascotMessage("That word is already in our guestbook. Let’s invite someone new. ✨");
        return;
      }

      const isSpecial = SPECIAL_SET.has(word);

      state.foundSet.add(word);
      state.foundWords.push({ word, isSpecial });

      if (isSpecial) {
        state.specialFound.add(word);

        showToast("A special word arrives at the bathhouse!", { good: true, emoji: "🌟" });

        if (specialSoundEl) {
          try {
            specialSoundEl.currentTime = 0;
            specialSoundEl.volume = 0.9;
            specialSoundEl.play();
          } catch (e) {}
        }

        const specialMood = Math.random() < 0.5 ? "excited" : "jumping";
        setMascotMood(specialMood);
        setMascotMessage("Look! That one sparkles differently—an honored guest has stepped off the train. 💫");
        triggerMascotDance();
      } else {
        if (word.length >= 6) {
          showToast("A long, graceful name.", { good: true, emoji: "💫" });
          setMascotMood("soft");
          setMascotMessage("What a beautiful, winding word. It feels like the train gliding over the water. 🚂");
        } else {
          showToast("A new word spirit appears.", { good: true, emoji: "✨" });
          setMascotMood("mischief");
          setMascotMessage("Nice find! More quiet little names are still hiding between the tiles. 🌌");
        }
      }

      updateSpecialListUI();
      updateWordsUI();
      updateGoalProgressUI();
      clearPath();

      if (checkCompletion()) {
        showCompletionOverlay();
      }
    }

    function createGrid() {
      if (!gridEl) return;
      gridEl.innerHTML = "";

      for (let r = 0; r < GRID.length; r++) {
        for (let c = 0; c < GRID[r].length; c++) {
          const letter = GRID[r][c];
          const tile = document.createElement("button");
          tile.className = "tile";
          tile.dataset.row = String(r);
          tile.dataset.col = String(c);

          if (!letter || letter === " ") {
            tile.classList.add("blank");
            tile.disabled = true;
          } else {
            tile.textContent = letter.toUpperCase();
            const idx = document.createElement("div");
            idx.className = "tile-index";
            tile.appendChild(idx);
          }

          gridEl.appendChild(tile);
        }
      }
    }

    function setupInteractions() {
      const tiles = Array.from(gridEl.querySelectorAll(".tile")).filter(t => !t.classList.contains("blank"));

      tiles.forEach(tile => {
        tile.addEventListener("mousedown", e => {
          e.preventDefault();
          startAmbientMusic();
          state.dragging = true;
          clearPath();
          addTileToPath(tile);
        });

        tile.addEventListener("mouseenter", () => {
          if (state.dragging) {
            addTileToPath(tile);
          }
        });

        tile.addEventListener("click", () => {
          if (!state.dragging) {
            startAmbientMusic();
            addTileToPath(tile);
          }
        });
      });

      document.addEventListener("mouseup", () => {
        if (state.dragging) {
          state.dragging = false;
          if (state.path.length) {
            handleSubmitWord();
          }
        } else {
          state.dragging = false;
        }
      });

      document.addEventListener("keydown", e => {
        if (e.key === "Enter") {
          handleSubmitWord();
        } else if (e.key === "Escape") {
          clearPath();
          setMascotMood("soft");
          setMascotMessage("No rush. Take a breath, then choose a new path along the tracks. 🕯️");
        } else if (!ambientStarted) {
          startAmbientMusic();
        }
      });

      if (closeOverlayBtn) {
        closeOverlayBtn.addEventListener("click", hideCompletionOverlay);
      }

      if (overlayEl) {
        overlayEl.addEventListener("click", e => {
          if (e.target === overlayEl) hideCompletionOverlay();
        });
      }

      if (resetBtn) {
        resetBtn.addEventListener("click", () => {
          startAmbientMusic();
          resetGame();
        });
      }

      if (playAgainBtn) {
        playAgainBtn.addEventListener("click", () => {
          hideCompletionOverlay();
          startAmbientMusic();
          resetGame();
        });
      }

      if (mascotEl) {
        mascotEl.style.cursor = "pointer";
        mascotEl.addEventListener("click", () => {
          startAmbientMusic();
          giveHint();
        });
      }
    }

    function resetGame() {
      clearPath();
      state.foundWords = [];
      state.foundSet = new Set();
      state.specialFound = new Set();

      const tiles = gridEl.querySelectorAll(".tile");
      tiles.forEach(t => {
        t.classList.remove("selected");
        const idx = t.querySelector(".tile-index");
        if (idx) idx.textContent = "";
      });

      hideCompletionOverlay();
      updateSpecialListUI();
      updateWordsUI();
      updateGoalProgressUI();
      setMascotMessage("The guestbook has been gently wiped clean. New word-spirits will be along soon. 🌙");
      showToast("Puzzle reset. The night begins anew.", { good: true, emoji: "🔄" });
      setMascotMood("soft");
    }

    // --- Init ---
    createGrid();
    setupInteractions();
    updateCurrentWordDisplay();
    updateSpecialListUI();
    updateWordsUI();
    updateGoalProgressUI();
    setMascotMood("soft");
  </script>
</body>
</html>
